### Region(리전) 및 Availability Zone(가용 영역)

AWS가 전 세계에서 데이터 센터를 클러스터링 하는 물리적 위치를 `Region`이라고 하며, 논리적 데이터 센터의 각 그룹을 `Availability Zone`(이하 `AZ`)이라고 한다.

각 `Region`은 지리적 영역 내에서 격리되고 물리적으로 분리된 여러 개의 `AZ`로 구성된다. (ex. 서울 Region - 목동 `AZ`, 일산 `AZ` 등)

\*\* `VPC` 를 디자인할 때 Multi `AZ`를 기반으로 구성한다면 정전, 낙뢰, 토네이도, 지진 등과 같은 문제로부터 안전하게 보호된다. (데이터 이중화)

<br />

### VPC(Virtual Private Cloud)란?

Virtual Private Cloud. 직역하면 "가상 사설 클라우드"로 말 그대로 가상의 사설 공간을 만드는 것이다.

AWS는 `VPC`의 중요성을 강조하여 2019년부터 모든 서비스에 `VPC`를 적용하도록 강제했다.

만일 지금까지 `VPC`를 한번도 만들어 보지 않고 인스턴스 생성을 했다면, AWS에서 제공하는 default `VPC`에 인스턴스가 배치되어 있을 것이다.

**왜 사용할까?**

`VPC` 없이 AWS 하나의 네트워크에 모든 인스턴스들이 있다면 인스턴스끼리의 구분 없는 연결로 인해 시스템 복잡도가 증가할 것이다. 이에 따라 각각 분리시켜줘야 할 필요가 있어 사용한다.

`VPC`를 사용하면 각각 네트워크를 다르게 구성할 수 있어 관리가 용이하며, 분리된 `VPC`는 완전히 독립된 네트워크처럼 작동하게 된다.

**구축하는 법**

`VPC`를 구축하기 위해서는 `VPC`의 `IP`범위를 RFC1918이라는 사설 아이피 대역에 맞추어 구축해야 한다.

<RFC1918에서 규정한 사설 IP 주소의 범위>

- 10.0.0.0 ~ 10.255.255.255(10.0.0.0/8)
- 172.16.0.0 ~ 172.31.255.255(172.16.0.0/12)
- 192.168.0.0 ~ 192.168.255.255(192.168.0.0/16)

한번 설정된 `IP` 대역은 수정할 수 없으며 `VPC`는 하나의 `Region`에 종속된다.

각각의 `VPC`는 완전히 독립적이기 때문에 서로 통신할 수 없고, 만약 `VPC` 간 통신을 원한다면 `VPC` 피어링 서비스를 통해 `VPC` 간에 트래픽을 라우팅 할 수 있도록 설정할 수 있다.

<br />

### CIDR(Classless Inter-Domain Routing, 사이더)란?

`CIDR`는 클래스 없는 도메인 간 라우팅 기법으로 기존의 네트워크 클래스 방식(A~E Class)을 대체하는 `IP` 주소 할당 방법이다.

`CIDR`는 위 <RFC1918에서 규정한 사설 IP 주소의 범위> 에서 괄호 안에 보이는 것과 같이 과 같이 "/xx"를 붙여 표기하며, 이 숫자는 비트 단위로 0~32까지 표현이 가능하다. (IPv4 주소는 4개의 Octet. 하나의 Octet은 8bit)  
"/xx"의 뜻은 `IP` 주소에서 xx bit까지는 Network 범위로 사용 가능, 그 이후에 오는 bit들은 Host 범위로 사용 가능하다는 뜻이다.

예시를 들어 살펴보자.

1.  192.168.0.0/16  
    2진수 변환 → 11000000.10101000.**00000000.00000000  
    **11000000.10101000.**00000000.00000000** ~ 11000000.10101000.**11111111.11111111  
    **\= 192.168.0.0 ~ 192.168.255.255 사용 가능
2.  172.16.101.31/22  
    2진수 변환 → 10101100.00010000.011001**01.00011111  
    **10101100.00010000.011001**00.00000000** ~ 10101100.00010000.011001**11.11111111  
    **\= 172.16.100.0 ~ 172.16.103.255 사용 가능
3.  10.101.164.81/32  
    32비트가 전부 Network ID이기 때문에 Host 범위로는 10.101.164.81 하나만 가능하다.

<br />

### Subnet(서브넷)이란?

`Subnet`은 `VPC`를 잘게 나눈 것이라고 보면 된다.

`AZ`안에 속해있으며, `Subnet`안에 RDS, EC2와 같은 인스턴스들을 생성해 사용한다.

**왜 사용할까?**

`Subnet`은 `VPC`보다 더 작은 단위이기 때문에 당연히 `CIDR`값은 높고 `IP`범위는 더 작은 값을 갖게 된다.

따라서 `IP` 주소를 더 효율적으로 나누게 되어 관리가 편해지고 낭비되는 `IP`주소 자원을 최소화하게 된다.  
또한 보안성 강화, 부하 감소 등의 장점도 있다.

**Subnet의 종류**

1.  Public Subnet  
    `Route Table`에 `Internet Gateway`가 등록되어 있어 있어 **외부 인터넷과 통신이 가능**한 경우이다.  
    **외부에서 접근이 가능**한 `Subnet` 이다.
2.  Private Subnet  
    `Route Table`에 `Internet Gateway`가 등록되어 있는 않아 **외부 인터넷과 통신이 불가능**한 경우이다.  
    **외부에서 접근이 불가능**한 `Subnet` 이다.

<br />

### Route Table(라우팅 테이블)이란?

`Route Table`은 `VPC`의 각 `Subnet`을 연결하여 `Subnet`에 대한 라우팅을 제어하는 것이다.  
쉽게 생각하면 목적지로 가려면 어느 쪽으로 가야 되는지 알려주는 이정표이다.

Default `Route Table`을 살펴보면 아래와 같이 되어있다.

1.  172.31.0.0/16 → local
2.  0.0.0.0/0 → igw-**\*\***

이 뜻은 172.31.0.0/16(Default `VPC`) 안의 네트워크 요청은 local(`VPC` 내부), 그 외의 요청은 igw(`Internet Gateway`)로 보내는 것이다.

<br />

### Internet Gateway(인터넷 게이트웨이)란?

`Internet Gateway`(이하 `IGW`)는 `Subnet`을 외부 인터넷과 통신을 할 수 있게 해 준다.

방법으로 `IGW`를 등록한 `Route Table`에 `Subnet`을 연결하면 해당 `Subnet`은 Public `Subnet`.

즉, 외부 인터넷과 통신을 할 수 있는 `Subnet`이 되는 것이다.

`VPC`에 생성된 인스턴스들은 기본적으로 격리된 환경으로 인터넷을 사용할 수가 없기 때문에, 외부 인터넷과 통신을 하려면 위와 같은 `IGW`와의 연결이 필수이다.

\*\* 하나의 `VPC` 에는 하나의 `IGW`만 사용 가능하다.

<br />

### NAT gateway(NAT 게이트웨이)란?

`NAT`은 네트워크 주소 변환(Network Address Translation)의 약자로, 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 `IP` 주소를 사용하여 인터넷에 접속하는 방법이다. 그리고 이것을 처리해주는 장치가 `NAT Gateway`이다.

흔히 인터넷에서 Private `Subnet` 에 접근 불가 조건은 유지하면서 반대로 외부 인터넷과 통신하기 위해 사용되며 사용 방법은 아래와 같다.

1.  `NAT gateway`가 속할 Public `Subnet`과 `Elastic IP`를 지정한다.
2.  `Private Subnet`과 연결된 `Route Table`에 `NAT gateway`를 등록한다.
3.  `NAT gateway`가 속해있는 `Public Subnet`이 인터넷과 통신할 수 있기 때문에 인터넷과 통신 성공!

<br />

### Elastic Ip(탄력적 Ip)란?

`Elastic IP`는 고정된 공인 IP를 제공하는 인터넷에서 연결 가능한 Public IPv4 주소이다.

주로 `EC2`, `NAT gateway`에 고정된 공인 `IP`가 필요할 때 사용한다.

<br />

### Network ACL(네트워크 ACL) 및 Security Group(보안 그룹)

`Network ACL`과 `Security Group` 모두 `VPC` 환경 내 네트워크 흐름을 제어하여 보안 강화를 위해 사용되는 일종의 부가 기능이다.

**네트워크 ACL (Access control list, 접근 제어 목록)**

1.  Stateless하게 작동한다.  
    \-> Inbound 규칙을 적용받아 유입이 되어도 Status를 기억하지 못하여 다시 밖으로 나갈때 Outbound 규칙을 적용 받아야한다.  
    즉, ACL의 Outbound 규칙에 요청에 대한 응답 포트를 오픈하지 않을 경우, 응답은 거부되며 최종적으로 client에게 요청 결과가 전송되지 않게 된다. 따라서 Inbound / Outbound 규칙 관리의 중요성이 크다.
2.  Subnet 단위로 적용된다.  
    \-> 1개 이상의 Subnet에 적용이 가능하며 해당 Subnet들의 트래픽을 제어한다.  
    Subnet 안에 인스턴스들이 존재하니 해당 Subnet의 모든 인스턴스들도 ACL 규칙이 적용 된다고 보면 된다.
3.  허용 규칙과 거부 규칙을 모두 지원한다.
4.  ACL 규칙 목록은 번호가 낮은 것부터 우선으로 적용된다.

**Security Group (보안 그룹)**

1.  Stateful하게 작동한다.  
    \-> Inbound 규칙을 적용받아 유입이 되면 Status를 기억하여 Outbound 규칙을 적용받지 않는다.
2.  인스턴스 단위로 적용된다.  
    \-> 1개 이상의 인스턴스의 트래픽을 제어하며 해당 인스턴스들의 트래픽을 제어한다.
3.  허용 규칙만 지정이 가능하며, 거부 규칙은 불가능하다
4.  기본적으로 Inbound 트래픽의 경우 All Deny 이고, Outbound 트래픽의 경우 All Allow 상태이다.  
    \-> Inbound 트래픽에서는 허용 규칙만 지정, Outbound 트래픽에서는 필요하다면 All Allow 규칙 삭제 후 원하는 Allow 규칙만 추가하여 제어하면 된다.

\*\* 만약 `Network ACL`과 `Security Group`이 서로 충돌할 경우, `Security Group`이 더 높은 우선순위를 갖는다.
