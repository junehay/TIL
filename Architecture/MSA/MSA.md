# Architecture

## 1. MA(Monolithic Architecture)

`MSA`와 반대되는 개념으로 전통의 아키텍쳐를 지칭한다.

서비스가 하나의 거대한 아키텍쳐를 가질 때, `Monolithic` 하다고 한다.

> 규모가 작은 대부분의 서비스들이 `Monolithic` 구조로 되어있다.

### 장점

1. **단순한 구조**로 아키텍쳐 설계와 개발이 쉽다.
2. 테스트가 쉽다.
3. 쉽게 고가용성 서버 환경을 만들 수 있다.

### 단점

1. 빌드, 테스트, 배포 시간이 기하급수적으로 늘어나게 된다.
2. 사소한 수정사항이 있어도 **전체를 다시 테스트, 빌드, 배포** 해야한다.
3. **부분의 장애**가 **서비스 전체의 장애**로 이어질 수 있다.
4. 하나의 언어와 프레임워크에 종속적이다.
   <br />

## 2. MSA(MicroService Architecture)

API를 통해서만 상호작용할 수 있다.

즉, `MSA`는 서비스의 end-point(접근점)을 API 형태로 외부에 노출하고, 실질적인 세부 사항은 모두 추상화한다.

내부의 구현 로직, 아키텍처와 프로그래밍 언어, 데이터베이스, 품질 유지 체계와 같은 기술적인 사항들은 서비스 API에 의해 철저하게 가려진다.

### 장점

1. 새로 추가되거나 수정사항이 필요할시, 해당 서비스만 빠르게 빌드 및 배포가 가능하다.
2. 기능별로 자유로운 언어 및 프레임워크 선택이 가능하다.
3. 서비스의 부하에 따라 개별적으로 scale-out이 가능하다. (메모리, CPU적으로 상당부분 이득)

### 단점

1. 모놀리식에 비해 상대적으로 많이 복잡하다.
2. 서비스가 모두 분산되어 있기 때문에 개발자는 내부 시스템의 통신을 어떻게 가져가야 할지 정해야한다.
3. 통신의 장애와 서버의 부하 등이 있을 경우 어떻게 transaction을 유지할지 결정하고 구현해야한다.

---

## MSA에서의 고려사항

> 전체적인 아키텍쳐 그림 필요

1. 어떻게 나눌것인가? (서비스 분리 기준)
2. 서비스간 내부 통신 방법
3. 분산 transaction 처리 방법
4. Server or Serverless
5. 각 서비스별 CI/CD
6. 각 서비스별 DB
7. 에러 핸들링
8. 모니터링

> // TO-DO: 각 번호별 상세 내용 추가 필요

---

---

# 컨테이너 오케스트레이션 Tool (with AWS)

## ECS(Elastic Container Service)

AWS에서 제공하는 `컨테이너 오케스트레이션 서비스`로 여러 어플리케이션 컨테이너를 쉽고 빠르게 실행하고, 컨테이너를 적절하게 분배 및 확장 & 축소 할 수 있도록 도와주는 서비스이다.

k8s 기반인 `EKS`와 비교하여 부족한 기능들도 있지만, 상대적으로 적은 러닝커브와 Devops 비용으로 비교적 쉽게 접근이 가능하다.

### 구성 요소

1. **Task definition(작업 정의)**
   Docker 컨테이너를 실행할 때 각종 설정들을 정의하기 위해 사용한다.

   - 컨테이너의 이미지, CPU/메모리 리소스 할당 설정, port 매핑, volume 설정 같은 것들이 포함되며, 기존 docker run 명령에서 가능했던  대부분 옵션이 설정 가능하다.
   - `Task definition` 에는 한개 이상의 컨테이너에 대해 정의가 가능하며, `Task definition` 내부에 정의된 컨테이너 사이는 link 설정으로 연결이 가능하다. `Task definition` 에서 정의된 대로 실제 생성된 컨테이너들을 `Task` 라고 부르게 된다.

2. **Task(작업)**

   - `Task` 는 `Cluster` 에 속한 `Container instance` 에 배포되게 된다.
   - `ECS`의 최소 단위는 `Task` 이며, `Task` 에는 컨테이너를 한개만 포함할 수도 있고, 다수의 컨테이너를 포함할 수 있다.

3. **Cluster(클러스터)**
   - `Task` 가 배포되는 `Container instance` 들은 논리적인 그룹으로 묶이게 되는데 이 단위를 `Cluster` 라고 부른다.
   - `Task` 를 배포하기 위한 instance 는 반드시 `Cluster` 에 등록되어야 한다. (Container instance)
4. **Service(서비스)**
   - `Task` 들의 Life cycle 을 관리하는 부분을 `Service` 라고 한다.
   - `Task` 를 `Cluster`에 몇 개나 배포할 것인지 결정하고, 실제 `Task` 들을 외부에 서비스 하기 위해 ELB 에 연동 되는 부분을 관리하게된다.
     만약 실행 중인 `Task` 가 어떤 이유로 작동이 중지 되면 이것을 자동으로 감지해 새로운 `Task`를 `Cluster`에 배포 하는 고가용성에 대한 정책도 `Service` 에서 관리한다.
